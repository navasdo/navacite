<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/navasdo/navacite/templates/static/ico/navacite.ico">
     <a href="https://navacite.com" class="absolute top-4 right-4 z-10 p-1 rounded-full bg-gray-700/50 hover:bg-gray-600/50 transition" title="Back to Homepage"><img src="https://raw.githubusercontent.com/navasdo/oliver/main/navacite/gems/Navacite-Main.png" alt="Navacite Homepage" class="w-10 h-10 rounded-full"/></a>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar Grid</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Modal Animation & Backdrop */
        .modal {
            transition: opacity 300ms ease-in-out;
        }
        .modal-content {
            transition: opacity 300ms ease-in-out, transform 300ms ease-in-out;
        }
        .modal.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .modal:not(.hidden) {
            opacity: 1;
        }
        .modal.hidden .modal-content {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal:not(.hidden) .modal-content {
            opacity: 1;
            transform: scale(1);
        }
        /* Custom scrollbar for modals */
        .modal-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .modal-scroll::-webkit-scrollbar-track {
            background: #1e293b; /* slate-800 */
        }
        .modal-scroll::-webkit-scrollbar-thumb {
            background-color: #4c1d95; /* violet-800 */
            border-radius: 10px;
            border: 2px solid #1e293b;
        }

        /* Shake Animation for incorrect answers */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        /* Glow effect for correct answers/completed questions */
        .glow {
             box-shadow: 0 0 15px rgba(167, 139, 250, 0.5), 0 0 30px rgba(167, 139, 250, 0.3);
             border-color: #a78bfa;
        }
        
        /* Temporary Glow for Duplicate Submissions */
        @keyframes temporary-glow-green {
            0%, 100% { box-shadow: none; background-color: transparent; }
            50% { box-shadow: 0 0 15px rgba(74, 222, 128, 0.7); background-color: rgba(74, 222, 128, 0.1); }
        }
        .glow-green-temp {
            animation: temporary-glow-green 1s ease-in-out;
        }

        @keyframes temporary-glow-red {
            0%, 100% { box-shadow: none; background-color: transparent; }
            50% { box-shadow: 0 0 15px rgba(248, 113, 113, 0.7); background-color: rgba(248, 113, 113, 0.1); }
        }
        .glow-red-temp {
            animation: temporary-glow-red 1s ease-in-out;
        }

        /* Dialogue Box Animation */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-[#0c0a18] text-slate-300 font-sans">
    <div id="root"></div>

    <!-- Question Data Block -->
    <script id="question-data" type="application/json">
[
    {
        "grade": "K",
        "id": 1,
        "words": [
            "the dog",
            "ran"
        ],
        "correct": [
            "The dog ran."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 2,
        "words": [ "she", "likes", "to play" ],
        "correct": [ "She likes to play." ],
        "types": [],
        "required": 1
    },
    
    {
        "grade": "K",
        "id": 2,
        "words": [
            "I",
            "can",
            "jump",
            "high"
        ],
        "correct": [
            "I can jump high."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 3,
        "words": [
            "the ball",
            "is",
            "big"
        ],
        "correct": [
            "The ball is big.",
            "Is the ball big?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 4,
        "words": [
            "we",
            "play",
            "outside"
        ],
        "correct": [
            "We play outside."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 5,
        "words": [
            "she",
            "has",
            "a hat"
        ],
        "correct": [
            "She has a hat."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 6,
        "words": [
            "the cat",
            "is",
            "black"
        ],
        "correct": [
            "The cat is black.",
            "Is the cat black?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 7,
        "words": [
            "he",
            "likes",
            "to",
            "read"
        ],
        "correct": [
            "He likes to read."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 8,
        "words": [
            "I",
            "am",
            "sleepy"
        ],
        "correct": [
            "I am sleepy."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 9,
        "words": [
            "the house",
            "is",
            "tall"
        ],
        "correct": [
            "The house is tall.",
            "Is the house tall?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 10,
        "words": [
            "they",
            "are",
            "friends"
        ],
        "correct": [
            "They are friends."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 11,
        "words": [
            "he",
            "went",
            "to the store"
        ],
        "correct": [
            "He went to the store."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 12,
        "words": [
            "the sun",
            "is",
            "hot"
        ],
        "correct": [
            "The sun is hot.",
            "Is the sun hot?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 13,
        "words": [
            "I",
            "see",
            "a bird"
        ],
        "correct": [
            "I see a bird."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 14,
        "words": [
            "she",
            "sings",
            "a song"
        ],
        "correct": [
            "She sings a song."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 15,
        "words": [
            "the fish",
            "is",
            "swimming"
        ],
        "correct": [
            "The fish is swimming.",
            "Is the fish swimming?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 16,
        "words": [
            "we",
            "eat",
            "dinner"
        ],
        "correct": [
            "We eat dinner."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 17,
        "words": [
            "the moon",
            "is",
            "yellow"
        ],
        "correct": [
            "The moon is yellow."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 18,
        "words": [
            "the girl",
            "is",
            "fast"
        ],
        "correct": [
            "The girl is fast.",
            "Is the girl fast?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 19,
        "words": [
            "he",
            "built",
            "a castle"
        ],
        "correct": [
            "He built a castle."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 20,
        "words": [
            "I",
            "have",
            "two",
            "books"
        ],
        "correct": [
            "I have two books."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 21,
        "words": [
            "the boy",
            "is",
            "smart"
        ],
        "correct": [
            "The boy is smart.",
            "Is the boy smart?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 22,
        "words": [
            "we",
            "need",
            "a coat"
        ],
        "correct": [
            "We need a coat."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 23,
        "words": [
            "she",
            "runs",
            "very",
            "fast"
        ],
        "correct": [
            "She runs very fast."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 24,
        "words": [
            "the truck",
            "is",
            "big"
        ],
        "correct": [
            "The truck is big.",
            "Is the truck big?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 25,
        "words": [
            "I",
            "like",
            "to",
            "draw"
        ],
        "correct": [
            "I like to draw."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 26,
        "words": [
            "he",
            "found",
            "his",
            "keys"
        ],
        "correct": [
            "He found his keys."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 27,
        "words": [
            "the car",
            "is",
            "new"
        ],
        "correct": [
            "The car is new.",
            "Is the car new?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 28,
        "words": [
            "they",
            "play",
            "with",
            "toys"
        ],
        "correct": [
            "They play with toys."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 29,
        "words": [
            "the baby",
            "is",
            "happy"
        ],
        "correct": [
            "The baby is happy."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 30,
        "words": [
            "the flower",
            "is",
            "pretty"
        ],
        "correct": [
            "The flower is pretty.",
            "Is the flower pretty?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 31,
        "words": [
            "I",
            "went",
            "to",
            "school",
            "today"
        ],
        "correct": [
            "I went to school today."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 32,
        "words": [
            "she",
            "wants",
            "to",
            "play"
        ],
        "correct": [
            "She wants to play."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 33,
        "words": [
            "the bird",
            "is",
            "singing"
        ],
        "correct": [
            "The bird is singing.",
            "Is the bird singing?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 34,
        "words": [
            "he",
            "drinks",
            "water"
        ],
        "correct": [
            "He drinks water."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 35,
        "words": [
            "the cat",
            "likes",
            "to",
            "sleep"
        ],
        "correct": [
            "The cat likes to sleep."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 36,
        "words": [
            "the book",
            "is",
            "blue"
        ],
        "correct": [
            "The book is blue.",
            "Is the book blue?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 37,
        "words": [
            "we",
            "have",
            "fun"
        ],
        "correct": [
            "We have fun."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 38,
        "words": [
            "she",
            "knows",
            "the answer"
        ],
        "correct": [
            "She knows the answer."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 39,
        "words": [
            "the cup",
            "is",
            "full"
        ],
        "correct": [
            "The cup is full.",
            "Is the cup full?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 40,
        "words": [
            "I",
            "finished",
            "my",
            "homework"
        ],
        "correct": [
            "I finished my homework."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 41,
        "words": [
            "the wind",
            "blows",
            "hard"
        ],
        "correct": [
            "The wind blows hard."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 42,
        "words": [
            "the door",
            "is",
            "open"
        ],
        "correct": [
            "The door is open.",
            "Is the door open?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 43,
        "words": [
            "he",
            "helped",
            "his",
            "friend"
        ],
        "correct": [
            "He helped his friend."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 44,
        "words": [
            "the train",
            "is",
            "fast"
        ],
        "correct": [
            "The train is fast."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 45,
        "words": [
            "the sky",
            "is",
            "clear"
        ],
        "correct": [
            "The sky is clear.",
            "Is the sky clear?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 46,
        "words": [
            "they",
            "built",
            "a fort"
        ],
        "correct": [
            "They built a fort."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 47,
        "words": [
            "the baby",
            "laughs",
            "loudly"
        ],
        "correct": [
            "The baby laughs loudly."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 48,
        "words": [
            "the pizza",
            "is",
            "hot"
        ],
        "correct": [
            "The pizza is hot.",
            "Is the pizza hot?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "K",
        "id": 49,
        "words": [
            "she",
            "rides",
            "a bike"
        ],
        "correct": [
            "She rides a bike."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "K",
        "id": 50,
        "words": [
            "the milk",
            "is",
            "cold"
        ],
        "correct": [
            "The milk is cold.",
            "Is the milk cold?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 1,
        "words": [
            "the man",
            "is",
            "a",
            "teacher"
        ],
        "correct": [
            "The man is a teacher."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 2,
        "words": [
            "the boy",
            "went",
            "to",
            "school"
        ],
        "correct": [
            "The boy went to school."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 3,
        "words": [
            "mary",
            "and",
            "I",
            "played",
            "outside"
        ],
        "correct": [
            "Mary and I played outside."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 4,
        "words": [
            "the girl",
            "is",
            "eating",
            "a snack"
        ],
        "correct": [
            "The girl is eating a snack."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 5,
        "words": [
            "are",
            "we",
            "going",
            "to the park"
        ],
        "correct": [
            "Are we going to the park?",
            "We are going to the park."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 6,
        "words": [
            "my mom",
            "made",
            "cookies",
            "for",
            "me"
        ],
        "correct": [
            "My mom made cookies for me."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 7,
        "words": [
            "on",
            "tuesday",
            "we",
            "have",
            "gym"
        ],
        "correct": [
            "On Tuesday, we have gym.",
            "We have gym on Tuesday."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "1",
        "id": 8,
        "words": [
            "the cat",
            "sleeps",
            "in",
            "its",
            "bed"
        ],
        "correct": [
            "The cat sleeps in its bed."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 9,
        "words": [
            "did",
            "the dog",
            "chase",
            "the ball"
        ],
        "correct": [
            "Did the dog chase the ball?",
            "The dog did chase the ball."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 10,
        "words": [
            "I",
            "went",
            "to",
            "New York",
            "with",
            "my dad"
        ],
        "correct": [
            "I went to New York with my dad."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 11,
        "words": [
            "we",
            "read",
            "books",
            "and",
            "magazines"
        ],
        "correct": [
            "We read books and magazines."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 12,
        "words": [
            "is",
            "the baby",
            "drinking",
            "milk"
        ],
        "correct": [
            "Is the baby drinking milk?",
            "The baby is drinking milk."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 13,
        "words": [
            "the teacher",
            "gave",
            "a prize",
            "to",
            "john"
        ],
        "correct": [
            "The teacher gave a prize to John."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 14,
        "words": [
            "the school bus",
            "is",
            "yellow",
            "and",
            "big"
        ],
        "correct": [
            "The school bus is yellow and big."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 15,
        "words": [
            "a frog",
            "can",
            "hop",
            "and",
            "jump"
        ],
        "correct": [
            "A frog can hop and jump."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 16,
        "words": [
            "the family",
            "went",
            "to",
            "florida",
            "in",
            "July"
        ],
        "correct": [
            "The family went to Florida in July."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 17,
        "words": [
            "did",
            "the boy",
            "go",
            "to the zoo"
        ],
        "correct": [
            "Did the boy go to the zoo?",
            "The boy did go to the zoo."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 18,
        "words": [
            "I",
            "ate",
            "an apple",
            "a pear",
            "and",
            "a peach"
        ],
        "correct": [
            "I ate an apple, a pear, and a peach."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 19,
        "words": [
            "the flowers",
            "are",
            "red",
            "blue",
            "and",
            "yellow"
        ],
        "correct": [
            "The flowers are red, blue, and yellow."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 20,
        "words": [
            "my birthday",
            "is",
            "in",
            "october"
        ],
        "correct": [
            "My birthday is in October."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 21,
        "words": [
            "the sun",
            "shines",
            "in",
            "the",
            "sky"
        ],
        "correct": [
            "The sun shines in the sky."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 22,
        "words": [
            "I",
            "ate",
            "pancakes",
            "for",
            "breakfast"
        ],
        "correct": [
            "I ate pancakes for breakfast."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 23,
        "words": [
            "did",
            "the students",
            "learn",
            "their lesson"
        ],
        "correct": [
            "Did the students learn their lesson?",
            "The students did learn their lesson."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 24,
        "words": [
            "he",
            "can",
            "write",
            "a",
            "letter"
        ],
        "correct": [
            "He can write a letter."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 25,
        "words": [
            "the girl",
            "walked",
            "across",
            "the",
            "street"
        ],
        "correct": [
            "The girl walked across the street."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 26,
        "words": [
            "my friend",
            "lives",
            "on",
            "main",
            "street"
        ],
        "correct": [
            "My friend lives on Main Street."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 27,
        "words": [
            "the boy",
            "threw",
            "the ball",
            "to",
            "lisa"
        ],
        "correct": [
            "The boy threw the ball to Lisa."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 28,
        "words": [
            "the box",
            "is",
            "under",
            "the",
            "bed"
        ],
        "correct": [
            "The box is under the bed."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 29,
        "words": [
            "do",
            "you",
            "want",
            "to play",
            "a game"
        ],
        "correct": [
            "Do you want to play a game?",
            "You want to play a game."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 30,
        "words": [
            "we",
            "saw",
            "a bear",
            "a deer",
            "and",
            "a fox"
        ],
        "correct": [
            "We saw a bear, a deer, and a fox."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 31,
        "words": [
            "is",
            "the party",
            "on",
            "saturday"
        ],
        "correct": [
            "Is the party on Saturday?",
            "The party is on Saturday."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 32,
        "words": [
            "she",
            "is",
            "riding",
            "her",
            "bicycle"
        ],
        "correct": [
            "She is riding her bicycle."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 33,
        "words": [
            "I",
            "put",
            "the toys",
            "in",
            "the box"
        ],
        "correct": [
            "I put the toys in the box."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 34,
        "words": [
            "we",
            "go",
            "to",
            "the library",
            "on",
            "monday"
        ],
        "correct": [
            "We go to the library on Monday."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 35,
        "words": [
            "did",
            "the girl",
            "find",
            "her toy"
        ],
        "correct": [
            "Did the girl find her toy?",
            "The girl did find her toy."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 36,
        "words": [
            "the big",
            "dog",
            "barked",
            "at",
            "the",
            "mailman"
        ],
        "correct": [
            "The big dog barked at the mailman."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 37,
        "words": [
            "he",
            "ate",
            "an orange",
            "a banana",
            "and",
            "grapes"
        ],
        "correct": [
            "He ate an orange, a banana, and grapes."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 38,
        "words": [
            "is",
            "the baby",
            "sleeping",
            "in",
            "the crib"
        ],
        "correct": [
            "Is the baby sleeping in the crib?",
            "The baby is sleeping in the crib."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 39,
        "words": [
            "the car",
            "is",
            "driving",
            "on",
            "the",
            "road"
        ],
        "correct": [
            "The car is driving on the road."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 40,
        "words": [
            "can",
            "we",
            "go",
            "to the beach",
            "in",
            "florida"
        ],
        "correct": [
            "Can we go to the beach in Florida?",
            "We can go to the beach in Florida."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 41,
        "words": [
            "the cat",
            "is",
            "sleeping",
            "on",
            "the",
            "blanket"
        ],
        "correct": [
            "The cat is sleeping on the blanket."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 42,
        "words": [
            "the boy",
            "built",
            "a rocket",
            "with",
            "his",
            "dad"
        ],
        "correct": [
            "The boy built a rocket with his dad."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 43,
        "words": [
            "do",
            "you",
            "like",
            "summer",
            "or",
            "winter"
        ],
        "correct": [
            "Do you like summer or winter?",
            "You like summer or winter."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 44,
        "words": [
            "my brother",
            "has",
            "a new",
            "game"
        ],
        "correct": [
            "My brother has a new game."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 45,
        "words": [
            "the baby",
            "crawled",
            "under",
            "the",
            "table"
        ],
        "correct": [
            "The baby crawled under the table."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 46,
        "words": [
            "he",
            "can",
            "ride",
            "a bike",
            "a scooter",
            "and",
            "a skateboard"
        ],
        "correct": [
            "He can ride a bike, a scooter, and a skateboard."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 47,
        "words": [
            "the man",
            "is",
            "cooking",
            "dinner",
            "in",
            "the kitchen"
        ],
        "correct": [
            "The man is cooking dinner in the kitchen."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 48,
        "words": [
            "the bird",
            "flew",
            "over",
            "the",
            "nest"
        ],
        "correct": [
            "The bird flew over the nest."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "1",
        "id": 49,
        "words": [
            "are",
            "you",
            "from",
            "New York"
        ],
        "correct": [
            "Are you from New York?",
            "You are from New York."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "1",
        "id": 50,
        "words": [
            "the students",
            "read",
            "about",
            "plants",
            "and",
            "animals"
        ],
        "correct": [
            "The students read about plants and animals."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 1,
        "words": [
            "the girl",
            "put the book",
            "on the shelf"
        ],
        "correct": [
            "The girl put the book on the shelf."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 2,
        "words": [
            "he",
            "didn't",
            "want",
            "to go",
            "to the store"
        ],
        "correct": [
            "He didn't want to go to the store."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 3,
        "words": [
            "after",
            "the movie",
            "ended",
            "we",
            "went home"
        ],
        "correct": [
            "After the movie ended, we went home.",
            "We went home after the movie ended."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "3",
        "id": 4,
        "words": [
            "the boy",
            "gave",
            "his sister",
            "a toy"
        ],
        "correct": [
            "The boy gave his sister a toy."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 5,
        "words": [
            "the cake",
            "which",
            "was chocolate",
            "was delicious"
        ],
        "correct": [
            "The cake, which was chocolate, was delicious.",
            "The cake was delicious which was chocolate."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "3",
        "id": 6,
        "words": [
            "shouldn't",
            "you",
            "have",
            "finished",
            "your homework"
        ],
        "correct": [
            "Shouldn't you have finished your homework?",
            "You shouldn't have finished your homework."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "3",
        "id": 7,
        "words": [
            "the team",
            "won the game",
            "because",
            "they",
            "practiced",
            "hard"
        ],
        "correct": [
            "The team won the game because they practiced hard.",
            "Because they practiced hard, the team won the game."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "3",
        "id": 8,
        "words": [
            "was",
            "the ball",
            "thrown",
            "by",
            "the boy"
        ],
        "correct": [
            "Was the ball thrown by the boy?",
            "The ball was thrown by the boy."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "3",
        "id": 9,
        "words": [
            "the girl",
            "wanted",
            "to buy",
            "a new",
            "dress"
        ],
        "correct": [
            "The girl wanted to buy a new dress."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 10,
        "words": [
            "the dog",
            "chased",
            "the cat",
            "up the",
            "tree"
        ],
        "correct": [
            "The dog chased the cat up the tree."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 11,
        "words": [
            "she",
            "is",
            "not only",
            "smart",
            "but also",
            "kind"
        ],
        "correct": [
            "She is not only smart but also kind."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 12,
        "words": [
            "wasn't",
            "the book",
            "read",
            "by the",
            "student"
        ],
        "correct": [
            "Wasn't the book read by the student?",
            "The book wasn't read by the student."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "3",
        "id": 13,
        "words": [
            "the man",
            "who",
            "lives",
            "next door",
            "is a",
            "doctor"
        ],
        "correct": [
            "The man who lives next door is a doctor."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 14,
        "words": [
            "the movie",
            "was",
            "directed",
            "by a",
            "famous",
            "director"
        ],
        "correct": [
            "The movie was directed by a famous director."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 15,
        "words": [
            "he",
            "likes",
            "to swim",
            "to hike",
            "and",
            "to bike"
        ],
        "correct": [
            "He likes to swim, to hike, and to bike."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 16,
        "words": [
            "while",
            "I was",
            "sleeping",
            "the cat",
            "played"
        ],
        "correct": [
            "While I was sleeping, the cat played.",
            "The cat played while I was sleeping."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "3",
        "id": 17,
        "words": [
            "the teacher",
            "gave",
            "the students",
            "a test"
        ],
        "correct": [
            "The teacher gave the students a test."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 18,
        "words": [
            "the car",
            "was",
            "repaired",
            "by the",
            "mechanic"
        ],
        "correct": [
            "The car was repaired by the mechanic."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 19,
        "words": [
            "hasn't",
            "he",
            "been",
            "to the",
            "doctor"
        ],
        "correct": [
            "Hasn't he been to the doctor?",
            "He hasn't been to the doctor."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "3",
        "id": 20,
        "words": [
            "the girl",
            "with",
            "the red",
            "hair",
            "is my",
            "sister"
        ],
        "correct": [
            "The girl with the red hair is my sister."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 21,
        "words": [
            "the storm",
            "which",
            "was strong",
            "caused",
            "damage"
        ],
        "correct": [
            "The storm, which was strong, caused damage.",
            "The storm caused damage which was strong."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "3",
        "id": 22,
        "words": [
            "the boy",
            "likes",
            "to read",
            "books"
        ],
        "correct": [
            "The boy likes to read books."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 23,
        "words": [
            "the letter",
            "was",
            "delivered",
            "by the",
            "mailman"
        ],
        "correct": [
            "The letter was delivered by the mailman."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 24,
        "words": [
            "whenever",
            "it rains",
            "I",
            "stay",
            "inside"
        ],
        "correct": [
            "Whenever it rains, I stay inside.",
            "I stay inside whenever it rains."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "3",
        "id": 25,
        "words": [
            "she",
            "is",
            "either",
            "at home",
            "or",
            "at the library"
        ],
        "correct": [
            "She is either at home or at the library."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 26,
        "words": [
            "couldn't",
            "you",
            "find",
            "the",
            "keys"
        ],
        "correct": [
            "Couldn't you find the keys?",
            "You couldn't find the keys."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "3",
        "id": 27,
        "words": [
            "the dog",
            "that",
            "barks",
            "loudly",
            "is",
            "annoying"
        ],
        "correct": [
            "The dog that barks loudly is annoying."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 28,
        "words": [
            "the cake",
            "was",
            "eaten",
            "by the",
            "children"
        ],
        "correct": [
            "The cake was eaten by the children."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 29,
        "words": [
            "he",
            "is",
            "neither",
            "a doctor",
            "nor",
            "a lawyer"
        ],
        "correct": [
            "He is neither a doctor nor a lawyer."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 30,
        "words": [
            "unless",
            "you study",
            "you will",
            "not",
            "pass"
        ],
        "correct": [
            "Unless you study, you will not pass.",
            "You will not pass unless you study."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "3",
        "id": 31,
        "words": [
            "the girl",
            "who",
            "is tall",
            "is a",
            "basketball",
            "player"
        ],
        "correct": [
            "The girl who is tall is a basketball player."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 32,
        "words": [
            "where",
            "was",
            "the car",
            "parked",
            "by the",
            "driver"
        ],
        "correct": [
            "Where was the car parked by the driver?",
            "The car was parked by the driver where?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "3",
        "id": 33,
        "words": [
            "the book",
            "was so",
            "interesting",
            "that",
            "I",
            "read it twice"
        ],
        "correct": [
            "The book was so interesting that I read it twice."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 34,
        "words": [
            "the game",
            "was",
            "won",
            "by our",
            "team"
        ],
        "correct": [
            "The game was won by our team."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 35,
        "words": [
            "if",
            "you are",
            "tired",
            "you",
            "should",
            "rest"
        ],
        "correct": [
            "If you are tired, you should rest.",
            "You should rest if you are tired."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "3",
        "id": 36,
        "words": [
            "the boy",
            "is",
            "both",
            "athletic",
            "and",
            "smart"
        ],
        "correct": [
            "The boy is both athletic and smart."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 37,
        "words": [
            "the money",
            "was",
            "stolen",
            "by the",
            "thief"
        ],
        "correct": [
            "The money was stolen by the thief."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 38,
        "words": [
            "why",
            "was",
            "the window",
            "broken",
            "by the",
            "boy"
        ],
        "correct": [
            "Why was the window broken by the boy?",
            "The window was broken by the boy why?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "3",
        "id": 39,
        "words": [
            "she",
            "is",
            "as",
            "beautiful",
            "as a",
            "flower"
        ],
        "correct": [
            "She is as beautiful as a flower."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 40,
        "words": [
            "the house",
            "which",
            "is white",
            "has a",
            "red",
            "door"
        ],
        "correct": [
            "The house, which is white, has a red door.",
            "The house has a red door which is white."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "3",
        "id": 41,
        "words": [
            "the letter",
            "was",
            "written",
            "by",
            "my grandpa"
        ],
        "correct": [
            "The letter was written by my grandpa."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 42,
        "words": [
            "although",
            "it was",
            "cold",
            "he",
            "went",
            "outside"
        ],
        "correct": [
            "Although it was cold, he went outside.",
            "He went outside although it was cold."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "3",
        "id": 43,
        "words": [
            "my friend",
            "gave",
            "me",
            "a new",
            "book"
        ],
        "correct": [
            "My friend gave me a new book."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 44,
        "words": [
            "the cat",
            "was",
            "chased",
            "by",
            "the dog"
        ],
        "correct": [
            "The cat was chased by the dog."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 45,
        "words": [
            "who",
            "was",
            "the letter",
            "written",
            "by"
        ],
        "correct": [
            "Who was the letter written by?",
            "The letter was written by who?"
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "3",
        "id": 46,
        "words": [
            "the students",
            "who",
            "are smart",
            "finished",
            "their work"
        ],
        "correct": [
            "The students who are smart finished their work."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 47,
        "words": [
            "the party",
            "was",
            "planned",
            "by",
            "my mom"
        ],
        "correct": [
            "The party was planned by my mom."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 48,
        "words": [
            "can't",
            "you",
            "see",
            "the movie",
            "with me"
        ],
        "correct": [
            "Can't you see the movie with me?",
            "You can't see the movie with me."
        ],
        "types": [
            "Interrogative"
        ],
        "required": 2
    },
    {
        "grade": "3",
        "id": 49,
        "words": [
            "the food",
            "was",
            "cooked",
            "by",
            "the chef"
        ],
        "correct": [
            "The food was cooked by the chef."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "3",
        "id": 50,
        "words": [
            "since",
            "it is",
            "raining",
            "we will",
            "stay",
            "inside"
        ],
        "correct": [
            "Since it is raining, we will stay inside.",
            "We will stay inside since it is raining."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "4",
        "id": 1,
        "words": [
            "the man",
            "who",
            "is wearing",
            "a red shirt",
            "is a doctor"
        ],
        "correct": [
            "The man, who is wearing a red shirt, is a doctor.",
            "The man who is wearing a red shirt is a doctor."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "4",
        "id": 2,
        "words": [
            "the students",
            "were excited",
            "to go",
            "on the trip"
        ],
        "correct": [
            "The students were excited to go on the trip."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 3,
        "words": [
            "the boy",
            "gave his",
            "sister",
            "a gift",
            "for her birthday"
        ],
        "correct": [
            "The boy gave his sister a gift for her birthday.",
            "The boy gave a gift to his sister for her birthday."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "4",
        "id": 4,
        "words": [
            "the dog",
            "that",
            "is barking",
            "belongs",
            "to my neighbor"
        ],
        "correct": [
            "The dog that is barking belongs to my neighbor."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 5,
        "words": [
            "she",
            "wanted",
            "to",
            "learn",
            "how to swim"
        ],
        "correct": [
            "She wanted to learn how to swim."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 6,
        "words": [
            "the children",
            "who",
            "are playing",
            "are",
            "my cousins"
        ],
        "correct": [
            "The children who are playing are my cousins."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 7,
        "words": [
            "the girl",
            "wrote a letter",
            "to her",
            "grandmother"
        ],
        "correct": [
            "The girl wrote a letter to her grandmother.",
            "The girl wrote her grandmother a letter."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "4",
        "id": 8,
        "words": [
            "the house",
            "that",
            "is on the",
            "corner",
            "is",
            "for sale"
        ],
        "correct": [
            "The house that is on the corner is for sale."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 9,
        "words": [
            "he",
            "is not only",
            "a good",
            "student",
            "but also",
            "an athlete"
        ],
        "correct": [
            "He is not only a good student but also an athlete."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 10,
        "words": [
            "the car",
            "which",
            "is red",
            "is",
            "parked",
            "outside"
        ],
        "correct": [
            "The car, which is red, is parked outside.",
            "The car is parked outside which is red."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "4",
        "id": 11,
        "words": [
            "she",
            "is either",
            "going to",
            "the movies",
            "or",
            "the park"
        ],
        "correct": [
            "She is either going to the movies or the park."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 12,
        "words": [
            "the teacher",
            "gave",
            "the students",
            "a reward"
        ],
        "correct": [
            "The teacher gave the students a reward."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 13,
        "words": [
            "the boy",
            "who",
            "is my",
            "friend",
            "is",
            "very",
            "funny"
        ],
        "correct": [
            "The boy who is my friend is very funny."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 14,
        "words": [
            "he",
            "is neither",
            "a doctor",
            "nor",
            "a dentist"
        ],
        "correct": [
            "He is neither a doctor nor a dentist."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 15,
        "words": [
            "the book",
            "was so",
            "good",
            "that",
            "I couldn't",
            "put it down"
        ],
        "correct": [
            "The book was so good that I couldn't put it down."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 16,
        "words": [
            "the girl",
            "is",
            "as",
            "smart",
            "as her",
            "brother"
        ],
        "correct": [
            "The girl is as smart as her brother."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 17,
        "words": [
            "the dog",
            "is",
            "both",
            "friendly",
            "and",
            "playful"
        ],
        "correct": [
            "The dog is both friendly and playful."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 18,
        "words": [
            "the meal",
            "was",
            "prepared",
            "by the",
            "chef"
        ],
        "correct": [
            "The meal was prepared by the chef."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 19,
        "words": [
            "the letter",
            "was",
            "written",
            "by the",
            "girl"
        ],
        "correct": [
            "The letter was written by the girl."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 20,
        "words": [
            "the test",
            "was",
            "taken",
            "by the",
            "students"
        ],
        "correct": [
            "The test was taken by the students."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 21,
        "words": [
            "the cake",
            "was",
            "eaten",
            "by the",
            "guests"
        ],
        "correct": [
            "The cake was eaten by the guests."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 22,
        "words": [
            "the ball",
            "was",
            "thrown",
            "by the",
            "pitcher"
        ],
        "correct": [
            "The ball was thrown by the pitcher."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 23,
        "words": [
            "the song",
            "was",
            "sung",
            "by the",
            "choir"
        ],
        "correct": [
            "The song was sung by the choir."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 24,
        "words": [
            "the picture",
            "was",
            "taken",
            "by the",
            "photographer"
        ],
        "correct": [
            "The picture was taken by the photographer."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 25,
        "words": [
            "the race",
            "was",
            "won",
            "by the",
            "runner"
        ],
        "correct": [
            "The race was won by the runner."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 26,
        "words": [
            "the book",
            "was",
            "read",
            "by the",
            "class"
        ],
        "correct": [
            "The book was read by the class."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 27,
        "words": [
            "the car",
            "was",
            "driven",
            "by the",
            "woman"
        ],
        "correct": [
            "The car was driven by the woman."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 28,
        "words": [
            "the movie",
            "was",
            "watched",
            "by the",
            "family"
        ],
        "correct": [
            "The movie was watched by the family."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 29,
        "words": [
            "the window",
            "was",
            "broken",
            "by the",
            "storm"
        ],
        "correct": [
            "The window was broken by the storm."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 30,
        "words": [
            "the house",
            "was",
            "built",
            "by the",
            "workers"
        ],
        "correct": [
            "The house was built by the workers."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 31,
        "words": [
            "the game",
            "was",
            "played",
            "by the",
            "children"
        ],
        "correct": [
            "The game was played by the children."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 32,
        "words": [
            "the gift",
            "was",
            "given",
            "by the",
            "man"
        ],
        "correct": [
            "The gift was given by the man."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 33,
        "words": [
            "the treasure",
            "was",
            "found",
            "by the",
            "explorer"
        ],
        "correct": [
            "The treasure was found by the explorer."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 34,
        "words": [
            "the cat",
            "was",
            "chased",
            "by the",
            "dog"
        ],
        "correct": [
            "The cat was chased by the dog."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 35,
        "words": [
            "the money",
            "was",
            "stolen",
            "by the",
            "thief"
        ],
        "correct": [
            "The money was stolen by the thief."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 36,
        "words": [
            "the party",
            "was",
            "planned",
            "by the",
            "committee"
        ],
        "correct": [
            "The party was planned by the committee."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 37,
        "words": [
            "the dinner",
            "was",
            "cooked",
            "by the",
            "mother"
        ],
        "correct": [
            "The dinner was cooked by the mother."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 38,
        "words": [
            "the phone",
            "was",
            "answered",
            "by the",
            "secretary"
        ],
        "correct": [
            "The phone was answered by the secretary."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 39,
        "words": [
            "the door",
            "was",
            "closed",
            "by the",
            "teacher"
        ],
        "correct": [
            "The door was closed by the teacher."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 40,
        "words": [
            "the problem",
            "was",
            "solved",
            "by the",
            "student"
        ],
        "correct": [
            "The problem was solved by the student."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 41,
        "words": [
            "the box",
            "was",
            "opened",
            "by the",
            "boy"
        ],
        "correct": [
            "The box was opened by the boy."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 42,
        "words": [
            "the dog",
            "which",
            "is big",
            "ate",
            "all the food"
        ],
        "correct": [
            "The dog, which is big, ate all the food.",
            "The dog ate all the food which is big."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "4",
        "id": 43,
        "words": [
            "he",
            "was",
            "surprised",
            "by the",
            "gift"
        ],
        "correct": [
            "He was surprised by the gift."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 44,
        "words": [
            "the house",
            "was",
            "painted",
            "by",
            "the crew"
        ],
        "correct": [
            "The house was painted by the crew."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 45,
        "words": [
            "the game",
            "which",
            "was fun",
            "was",
            "played",
            "by all"
        ],
        "correct": [
            "The game, which was fun, was played by all.",
            "The game was played by all which was fun."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "4",
        "id": 46,
        "words": [
            "the woman",
            "who",
            "lives next door",
            "gave",
            "me",
            "flowers"
        ],
        "correct": [
            "The woman who lives next door gave me flowers.",
            "The woman who lives next door gave flowers to me."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "4",
        "id": 47,
        "words": [
            "he",
            "didn't",
            "want",
            "to",
            "go",
            "to bed"
        ],
        "correct": [
            "He didn't want to go to bed."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 48,
        "words": [
            "the car",
            "was",
            "washed",
            "by",
            "the kids"
        ],
        "correct": [
            "The car was washed by the kids."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 49,
        "words": [
            "the book",
            "that",
            "I read",
            "was",
            "a mystery"
        ],
        "correct": [
            "The book that I read was a mystery."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "4",
        "id": 50,
        "words": [
            "the girl",
            "who",
            "is my sister",
            "is",
            "a good",
            "singer"
        ],
        "correct": [
            "The girl who is my sister is a good singer."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 1,
        "words": [
            "he",
            "has",
            "painted",
            "the fence"
        ],
        "correct": [
            "He has painted the fence."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 2,
        "words": [
            "either",
            "the dog",
            "or the cat",
            "is",
            "on the bed"
        ],
        "correct": [
            "Either the dog or the cat is on the bed."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 3,
        "words": [
            "my sister",
            "and",
            "I",
            "have finished",
            "our homework"
        ],
        "correct": [
            "My sister and I have finished our homework."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 4,
        "words": [
            "the girl",
            "had",
            "eaten",
            "her dinner",
            "before she went to bed"
        ],
        "correct": [
            "The girl had eaten her dinner before she went to bed."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 5,
        "words": [
            "neither",
            "the students",
            "nor the teacher",
            "was",
            "in the classroom"
        ],
        "correct": [
            "Neither the students nor the teacher was in the classroom."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 6,
        "words": [
            "the children",
            "have",
            "played",
            "in the park",
            "all morning"
        ],
        "correct": [
            "The children have played in the park all morning."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 7,
        "words": [
            "the movie",
            "which",
            "we saw",
            "was",
            "a comedy"
        ],
        "correct": [
            "The movie, which we saw, was a comedy.",
            "The movie was a comedy which we saw."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "5",
        "id": 8,
        "words": [
            "he",
            "had been",
            "studying",
            "for hours",
            "before he took a break"
        ],
        "correct": [
            "He had been studying for hours before he took a break."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 9,
        "words": [
            "not only",
            "is he smart",
            "but he is also",
            "a great",
            "artist"
        ],
        "correct": [
            "Not only is he smart, but he is also a great artist."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 10,
        "words": [
            "the package",
            "was",
            "delivered",
            "by the",
            "courier"
        ],
        "correct": [
            "The package was delivered by the courier."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 11,
        "words": [
            "the team",
            "will have",
            "finished",
            "the project",
            "by next week"
        ],
        "correct": [
            "The team will have finished the project by next week."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 12,
        "words": [
            "the cake",
            "was made",
            "by the baker",
            "for the wedding"
        ],
        "correct": [
            "The cake was made by the baker for the wedding."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 13,
        "words": [
            "both",
            "the boy",
            "and the girl",
            "are",
            "in the band"
        ],
        "correct": [
            "Both the boy and the girl are in the band."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 14,
        "words": [
            "the students",
            "had been",
            "working",
            "on the assignment",
            "all day"
        ],
        "correct": [
            "The students had been working on the assignment all day."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 15,
        "words": [
            "the book",
            "that",
            "is on the table",
            "was",
            "written",
            "by my friend"
        ],
        "correct": [
            "The book that is on the table was written by my friend."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 16,
        "words": [
            "the teacher",
            "gave",
            "the students",
            "a",
            "difficult",
            "assignment"
        ],
        "correct": [
            "The teacher gave the students a difficult assignment."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 17,
        "words": [
            "the children",
            "will be",
            "going",
            "to the zoo",
            "tomorrow"
        ],
        "correct": [
            "The children will be going to the zoo tomorrow."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 18,
        "words": [
            "the letter",
            "was",
            "sent",
            "to the wrong",
            "address"
        ],
        "correct": [
            "The letter was sent to the wrong address."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 19,
        "words": [
            "the team",
            "has",
            "won",
            "the championship",
            "three times"
        ],
        "correct": [
            "The team has won the championship three times."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 20,
        "words": [
            "the girl",
            "who",
            "is a great",
            "dancer",
            "is",
            "my",
            "cousin"
        ],
        "correct": [
            "The girl who is a great dancer is my cousin."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 21,
        "words": [
            "the problem",
            "was",
            "solved",
            "by the clever",
            "student"
        ],
        "correct": [
            "The problem was solved by the clever student."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 22,
        "words": [
            "the boy",
            "had",
            "finished",
            "his homework",
            "before he went out to play"
        ],
        "correct": [
            "The boy had finished his homework before he went out to play."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 23,
        "words": [
            "the music",
            "was",
            "played",
            "by a famous",
            "orchestra"
        ],
        "correct": [
            "The music was played by a famous orchestra."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 24,
        "words": [
            "the teacher",
            "gave",
            "the class",
            "a",
            "surprise",
            "quiz"
        ],
        "correct": [
            "The teacher gave the class a surprise quiz."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 25,
        "words": [
            "the team",
            "will have",
            "practiced",
            "for weeks",
            "before the game"
        ],
        "correct": [
            "The team will have practiced for weeks before the game."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 26,
        "words": [
            "the movie",
            "had been",
            "seen",
            "by millions",
            "of people"
        ],
        "correct": [
            "The movie had been seen by millions of people."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 27,
        "words": [
            "the boy",
            "is",
            "as",
            "tall",
            "as his",
            "father"
        ],
        "correct": [
            "The boy is as tall as his father."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 28,
        "words": [
            "the students",
            "have",
            "learned",
            "a lot",
            "this year"
        ],
        "correct": [
            "The students have learned a lot this year."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 29,
        "words": [
            "the food",
            "was",
            "prepared",
            "with",
            "fresh",
            "ingredients"
        ],
        "correct": [
            "The food was prepared with fresh ingredients."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 30,
        "words": [
            "the girl",
            "has",
            "been",
            "playing",
            "the piano",
            "for years"
        ],
        "correct": [
            "The girl has been playing the piano for years."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 31,
        "words": [
            "the car",
            "was",
            "repaired",
            "by a",
            "skilled",
            "mechanic"
        ],
        "correct": [
            "The car was repaired by a skilled mechanic."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 32,
        "words": [
            "he",
            "will have",
            "been",
            "working",
            "for eight",
            "hours"
        ],
        "correct": [
            "He will have been working for eight hours."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 33,
        "words": [
            "the team",
            "is",
            "both",
            "talented",
            "and",
            "hardworking"
        ],
        "correct": [
            "The team is both talented and hardworking."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 34,
        "words": [
            "the children",
            "have",
            "been",
            "reading",
            "all afternoon"
        ],
        "correct": [
            "The children have been reading all afternoon."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 35,
        "words": [
            "the test",
            "was",
            "graded",
            "by the",
            "teacher"
        ],
        "correct": [
            "The test was graded by the teacher."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 36,
        "words": [
            "the family",
            "had",
            "lived",
            "in the house",
            "for ten",
            "years"
        ],
        "correct": [
            "The family had lived in the house for ten years."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 37,
        "words": [
            "the painting",
            "was",
            "admired",
            "by",
            "the art",
            "critic"
        ],
        "correct": [
            "The painting was admired by the art critic."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 38,
        "words": [
            "she",
            "had been",
            "waiting",
            "for the bus",
            "for a long",
            "time"
        ],
        "correct": [
            "She had been waiting for the bus for a long time."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 39,
        "words": [
            "the gift",
            "was",
            "wrapped",
            "in",
            "beautiful",
            "paper"
        ],
        "correct": [
            "The gift was wrapped in beautiful paper."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 40,
        "words": [
            "the dog",
            "has",
            "been",
            "barking",
            "all",
            "night"
        ],
        "correct": [
            "The dog has been barking all night."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 41,
        "words": [
            "the project",
            "was",
            "completed",
            "by the",
            "team"
        ],
        "correct": [
            "The project was completed by the team."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 42,
        "words": [
            "the students",
            "were given",
            "an assignment",
            "by the",
            "teacher"
        ],
        "correct": [
            "The students were given an assignment by the teacher."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 43,
        "words": [
            "neither",
            "the boy",
            "nor the girl",
            "wanted",
            "to do",
            "the chores"
        ],
        "correct": [
            "Neither the boy nor the girl wanted to do the chores."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 44,
        "words": [
            "the book",
            "which",
            "has a red",
            "cover",
            "is mine"
        ],
        "correct": [
            "The book, which has a red cover, is mine.",
            "The book is mine which has a red cover."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "5",
        "id": 45,
        "words": [
            "the game",
            "had",
            "ended",
            "when",
            "we got there"
        ],
        "correct": [
            "The game had ended when we got there."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 46,
        "words": [
            "not only",
            "did they win",
            "but they also",
            "celebrated",
            "with a party"
        ],
        "correct": [
            "Not only did they win, but they also celebrated with a party."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 47,
        "words": [
            "the homework",
            "was",
            "completed",
            "by the student"
        ],
        "correct": [
            "The homework was completed by the student."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 48,
        "words": [
            "he",
            "has been",
            "working",
            "on his project",
            "all day"
        ],
        "correct": [
            "He has been working on his project all day."
        ],
        "types": [],
        "required": 1
    },
    {
        "grade": "5",
        "id": 49,
        "words": [
            "the movie",
            "that",
            "was a comedy",
            "was",
            "watched",
            "by everyone"
        ],
        "correct": [
            "The movie that was a comedy was watched by everyone.",
            "The movie was watched by everyone that was a comedy."
        ],
        "types": [],
        "required": 2
    },
    {
        "grade": "5",
        "id": 50,
        "words": [
            "the girl",
            "had been",
            "reading",
            "for an hour",
            "before her",
            "friends",
            "arrived"
        ],
        "correct": [
            "The girl had been reading for an hour before her friends arrived."
        ],
        "types": [],
        "required": 1
    }
]
</script>
{% raw %}
    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // --- Data & Audio ---
        const allQuestions = JSON.parse(document.getElementById('question-data').textContent);
        const correctSound = new Audio('https://raw.githubusercontent.com/navasdo/navacite/refs/heads/main/templates/static/audio/grammar-grid/2_out_of_2.wav');
        const incorrectSound = new Audio('https://raw.githubusercontent.com/navasdo/navacite/refs/heads/main/templates/static/audio/grammar-grid/incorrect.wav');


        // --- Utility Functions ---
        const shuffleArray = (array) => {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        };

        // --- Icon Components ---
        const IconCheck = () => ( <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg> );
        const IconReset = () => ( <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.5 2v6h-6"/><path d="M2.5 22v-6h6"/><path d="M22 11.5A10 10 0 0 0 12.5 3a9.99 9.99 0 0 0-6.2 2.3L2.5 9"/><path d="M2 12.5A10 10 0 0 0 11.5 21a9.99 9.99 0 0 0 6.2-2.3L21.5 15"/></svg> );
        const IconExport = () => ( <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg> );
        const IconInfo = () => (<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>);
        const IconPass = () => ( <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 19 22 12 13 5 13 19"></polygon><polygon points="2 19 11 12 2 5 2 19"></polygon></svg> );

        // --- Main App Component ---
        function App() {
          const [screen, setScreen] = useState('assessmentSetup');
          const [error, setError] = useState(null);
          const [showTermsModal, setShowTermsModal] = useState(false);
          const [assessmentSettings, setAssessmentSettings] = useState(null);
          const [resultsData, setResultsData] = useState(null);
          
          useEffect(() => {
            if (error) {
                const timeoutId = setTimeout(() => setError(null), 5000);
                return () => clearTimeout(timeoutId);
            }
          }, [error]);
          
          const handleStart = (settings) => { 
            setAssessmentSettings(settings); 
            if (settings.runTutorial) {
                setScreen('tutorial');
            } else {
                setScreen('app'); 
            }
          };
          const handleSubmit = (results) => { setResultsData(results); setScreen('results'); };
          const handleRestart = () => { setAssessmentSettings(null); setResultsData(null); setScreen('assessmentSetup'); };

          const renderScreen = () => {
            switch (screen) {
              case 'tutorial': return <TutorialScreen onComplete={() => setScreen('app')} />;
              case 'app': return <MainAppScreen onSubmit={handleSubmit} settings={assessmentSettings} />;
              case 'results': return <ResultsScreen onRestart={handleRestart} results={resultsData} />;
              case 'assessmentSetup': default: return <AssessmentSetupScreen onStartAssessment={handleStart} setError={setError} />;
            }
          };

          return (
            <div className="min-h-screen flex flex-col">
              <div className="container mx-auto p-4 sm:p-6 lg:p-8 max-w-5xl flex-grow">
                <header className="text-center mb-10">
                  <img src="https://raw.githubusercontent.com/navasdo/navacite/refs/heads/main/templates/static/navacite-images/navacite-gg-2.png" alt="App Gem" className="w-48 mx-auto mb-4" style={{filter: 'drop-shadow(0 0 15px rgba(255,255,255,0.3))'}} />
                  <h1 className="text-5xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-violet-400 to-fuchsia-500">Grammar Grid</h1>
                  <p className="text-slate-400 italic mt-2">Grammar Grid gives students practice with building sentences by rearranging and transforming word groups. In doing so, they strengthen their ability to create grammatically correct and meaningful sentences, a skill that supports classroom discussion, written expression, and everyday communication. The activity highlights how word order and structure shape meaning, offering insight into a student’s flexibility with language. These same skills connect to broader literacy growth, including reading comprehension, revising text, and adapting ideas across subject areas.</p>
                </header>
                {error && <div className="border border-red-500 bg-red-900/40 text-red-400 p-3 rounded-lg text-center my-4 max-w-5xl mx-auto">{error}</div>}
                <main className="bg-slate-900/40 p-6 sm:p-8 rounded-2xl shadow-lg border border-violet-900/80"> {renderScreen()} </main>
              </div>
              <footer className="w-full text-center text-sm text-slate-400 p-6">
                <p className="font-bold">&copy; {new Date().getFullYear()} Navacite | All Rights Reserved</p>
                <p className="mt-4 text-xs text-slate-500">Navacite tools are provided ‘as is’ and are not intended to diagnose. Use requires professional judgment. <br /> <a href="#" onClick={(e) => { e.preventDefault(); setShowTermsModal(true); }} className="underline hover:text-violet-400 transition-colors">Terms & Disclaimer</a></p>
              </footer>
              <TermsModal show={showTermsModal} onClose={() => setShowTermsModal(false)} />
            </div>
          );
        }

        // --- Modal Components ---
        const BaseModal = ({ show, onClose, children, maxWidth = 'max-w-2xl' }) => {
            if (!show) return null;
            return ReactDOM.createPortal(
                <div className={`modal ${show ? '' : 'hidden'} fixed inset-0 bg-black bg-opacity-75 backdrop-filter backdrop-blur-sm flex items-center justify-center z-50 p-4`} onClick={onClose}>
                    <div className={`modal-content bg-slate-800 border border-violet-700/50 rounded-2xl shadow-2xl shadow-violet-500/10 w-full ${maxWidth} max-h-[90vh] overflow-y-auto modal-scroll`} onClick={e => e.stopPropagation()}>
                        {children}
                    </div>
                </div>,
                document.body
            );
        };

        const TermsModal = ({ show, onClose }) => (
            <BaseModal show={show} onClose={onClose}>
                <div className="p-6 sm:p-8">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-3xl font-bold text-slate-100">Terms & Disclaimer</h2>
                        <button onClick={onClose} className="text-slate-400 hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                        </button>
                    </div>
                    <div className="space-y-6 text-slate-300 text-left text-sm">
                         <div><h3 className="text-xl font-semibold text-violet-400 mb-2">Disclaimer</h3><p>Navacite tools are provided “as is” and are not intended to diagnose, prevent, or cure any speech-language disorder. They are designed as supplemental engagement supports to be used by qualified professionals. Navacite makes no warranties, expressed or implied, and hereby disclaims and negates all other warranties, including without limitation, implied warranties of merchantability, fitness for a particular purpose, and non-infringement of intellectual property or other rights. Navacite does not warrant or make any representations concerning the accuracy, likely results, or reliability of the materials on this site or on any sites linked to it.</p></div>
                         <div><h3 className="text-xl font-semibold text-violet-400 mb-2">Professional Responsibility</h3><p>The responsibility for all clinical decisions, interpretations, and applications of Navacite tools rests solely with the licensed professional using them. Navacite assumes no liability for misuse, misapplication, or outcomes resulting from the use of these materials.</p></div>
                         <div><h3 className="text-xl font-semibold text-violet-400 mb-2">Revisions and Errata</h3><p>The materials appearing on Navacite’s web site may include technical, typographical, or content errors. Navacite does not warrant that any of the materials are accurate, complete, or current. Navacite may make changes to the materials contained on its site at any time without notice, but makes no commitment to update them.</p></div>
                         <div><h3 className="text-xl font-semibold text-violet-400 mb-2">Terms of Use Modifications</h3><p>Navacite may revise these terms of use at any time without notice. By using this site you agree to be bound by the then-current version of these Terms & Disclaimer provisions.</p></div>
                         <div><h3 className="text-xl font-semibold text-violet-400 mb-2">Conflict of Interest Disclaimer</h3><p>Navacite is an independent project created in a personal capacity by its author. It is not a product of, nor is it affiliated with, endorsed by, or representative of any school district, university, or employer. All intellectual property, design, and code on this site were developed as an independent effort, outside the scope of employment. Use of Navacite does not imply involvement, approval, or responsibility by any employer, past or present.</p></div>
                         <div><h3 className="text-xl font-semibold text-violet-400 mb-2">Limitation of Liability</h3><p>In no event shall Navacite or its creator be liable for any damages (including, without limitation, damages for loss of data, income, or clinical outcomes) arising out of the use or inability to use the materials on this site, even if Navacite has been notified of the possibility of such damages.</p></div>
                         <div><h3 className="text-xl font-semibold text-violet-400 mb-2">Governing Law</h3><p>Any claim relating to Navacite’s web site shall be governed by the laws of the State of Nebraska (USA), without regard to its conflict of law provisions.</p></div>
                    </div>
                </div>
            </BaseModal>
        );

        const PrivacyModal = ({ show, onClose }) => (
            <BaseModal show={show} onClose={onClose}>
                 <div className="p-6 sm:p-8">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-3xl font-bold text-slate-100">Student Data Privacy</h2>
                        <button onClick={onClose} className="text-slate-400 hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                        </button>
                    </div>
                    <div className="space-y-4 text-slate-300 text-left text-sm">
                        <p>This application is designed to support language assessment activities without collecting or maintaining student data.</p>
                        <p><strong className="text-violet-400 block mb-1">Student Information Use:</strong> Student names may be entered by the examiner for the sole purpose of personalizing a printable PDF report. This information is not transmitted, stored, or retained by the application or its hosting service.</p>
                        <p><strong className="text-violet-400 block mb-1">Data Retention:</strong> Once the examiner completes an assessment, the entered name is cleared from the page. No student information is written to logs, databases, or external servers.</p>
                        <p><strong className="text-violet-400 block mb-1">Ownership of Records:</strong> The only lasting record generated is the PDF report saved or printed by the examiner. As such, all student records remain under the direct custody and control of the examiner and their institution, in compliance with FERPA.</p>
                        <p><strong className="text-violet-400 block mb-1">Compliance Alignment:</strong> Because the application does not maintain education records or personally identifiable information, it functions as a local instructional tool rather than a record-keeping system.</p>
                    </div>
                </div>
            </BaseModal>
        );
        
        const DialogueBox = ({ characterName, characterImage, text, onClose }) => {
            if (!text) return null;
            return (
                <div className="fixed bottom-0 left-0 right-0 z-50 p-4 animate-fade-in-up">
                    <div className="max-w-3xl mx-auto bg-slate-900/90 backdrop-blur-sm border-2 border-violet-700 rounded-2xl shadow-lg flex items-end gap-2 sm:gap-4 p-4">
                        <img src={characterImage} alt={characterName} className="w-24 h-24 sm:w-32 sm:h-32 object-contain flex-shrink-0 -mb-4" />
                        <div className="flex-1 min-w-0">
                            <div className="bg-slate-800/70 inline-block px-4 py-1 rounded-t-lg border-t border-l border-r border-violet-800 -mb-px">
                                <p className="font-bold text-lg text-white">{characterName}</p>
                            </div>
                            <div className="p-4 bg-slate-800/50 rounded-lg rounded-tl-none border border-violet-800">
                                <p className="text-slate-300 text-sm sm:text-base" dangerouslySetInnerHTML={{ __html: text }}></p>
                                <div className="text-right mt-2">
                                    <button onClick={onClose} className="bg-violet-600 hover:bg-violet-700 text-white font-bold py-1 px-4 rounded-lg text-sm">Next ▸</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };


        // --- Tutorial Screen ---
        const TutorialScreen = ({ onComplete }) => {
          const [words, setWords] = useState([ { id: 1, text: "tasty", inSentence: false }, { id: 2, text: "the ice cream", inSentence: false }, { id: 3, text: "is", inSentence: false } ]);
          const [sentence, setSentence] = useState([]);
          const [completedSentences, setCompletedSentences] = useState([]);
          const [incorrectSentences, setIncorrectSentences] = useState([]);
          const [shake, setShake] = useState(false);
          const [glowingSentence, setGlowingSentence] = useState(null);
          const [dialogue, setDialogue] = useState({
            show: true,
            step: 'intro',
            name: 'Oliver',
            image: 'https://raw.githubusercontent.com/navasdo/navacite/refs/heads/main/templates/static/oliver/oliver_teach.png',
            text: "Welcome to the Grammar Grid! You're going to see some sentences broken up into blocks and scrambled up. It's your job to unscramble them - try it with these words!"
          });
          const correctAnswers = [ "the ice cream is tasty", "is the ice cream tasty" ];
          
          const normalize = (str) => str.toLowerCase().replace(/[^\w\s]|_/g, "").replace(/\s+/g, " ").trim();
          const handleReset = () => { setSentence([]); setWords(words.map(w => ({ ...w, inSentence: false }))); };
          
          const handleDialogueClose = () => {
            if (dialogue.step === 'outro') {
                onComplete();
            } else {
                setDialogue({ ...dialogue, show: false });
            }
          };

          const handleCheck = () => {
              if (sentence.length === 0 || dialogue.show) return;
              const userSentenceText = sentence.map(w => w.text).join(' ');
              const normalizedUserSentence = normalize(userSentenceText);

              if (completedSentences.includes(userSentenceText)) {
                  setGlowingSentence({ text: userSentenceText, type: 'correct' });
                  setTimeout(() => setGlowingSentence(null), 1000);
                  handleReset();
                  return;
              }
              if (incorrectSentences.some(s => s.text === userSentenceText)) {
                  incorrectSound.play();
                  setGlowingSentence({ text: userSentenceText, type: 'incorrect' });
                  setTimeout(() => setGlowingSentence(null), 1000);
                  handleReset();
                  return;
              }

              const isCorrect = correctAnswers.includes(normalizedUserSentence);

              if (isCorrect) {
                  correctSound.play();
                  const newCompleted = [...completedSentences, userSentenceText];
                  setCompletedSentences(newCompleted);

                  if (newCompleted.length === 1) {
                      const isTelling = normalize(userSentenceText) === "the ice cream is tasty";
                      setDialogue({
                          show: true, step: 'mid', name: 'Oliver',
                          image: 'https://raw.githubusercontent.com/navasdo/navacite/refs/heads/main/templates/static/oliver/oliver_think.png',
                          text: isTelling ? "You're right! 'The ice cream is tasty.' is a sentence that <b><i>tells</b></i> me something. Can you try making a sentence that <b><i>asks</b></i> me something?" : "You're right! 'Is the ice cream tasty?' is a sentence that <b><i>asks</b></i> me something. Can you try making a sentence that <b><i>tells</b></i> me something?"
                      });
                  } else if (newCompleted.length === correctAnswers.length) {
                      setDialogue({
                          show: true, step: 'outro', name: 'Oliver',
                          image: 'https://raw.githubusercontent.com/navasdo/navacite/refs/heads/main/templates/static/oliver/oliver_happy.png',
                          text: "Good job! From here on you will see new blocks, and have to make one or two sentences with those blocks. Remember, you won't see any question marks (?), periods (.), or commas (,) in any of the blocks! <br/><br/>Oh- and check that your sentences sound right when you read them out loud, too! Good luck!"
                      });
                  }
                  handleReset();

              } else {
                  incorrectSound.play();
                  setShake(true);
                  setIncorrectSentences(prev => [...prev, { text: userSentenceText, id: Date.now() }]);
                  setTimeout(() => { setShake(false); handleReset(); }, 500);
              }
          };
          
          const handleWordClick = (wordId) => { if(dialogue.show) return; const word = words.find(w => w.id === wordId); if (word && !word.inSentence) { setSentence(prev => [...prev, word]); setWords(prev => prev.map(w => w.id === wordId ? { ...w, inSentence: true } : w)); } };
          const sentencesNeeded = correctAnswers.length - completedSentences.length;

          return ( <div className="space-y-6"> <div className="grid grid-cols-2 gap-4 -mb-2"><div className="p-3 bg-slate-800/40 rounded-lg min-h-[6rem]"> <h4 className="text-sm font-bold text-green-400 mb-2 text-center">Correct Sentences</h4> <ul className="space-y-1">{completedSentences.map((s, i) => <li key={i} className={`text-xs text-slate-300 p-1 rounded transition-all ${glowingSentence?.text === s && glowingSentence?.type === 'correct' ? 'glow-green-temp' : ''}`}>{s}</li>)}</ul></div><div className="p-3 bg-slate-800/40 rounded-lg min-h-[6rem]"><h4 className="text-sm font-bold text-red-400 mb-2 text-center">Incorrect Attempts</h4><ul className="space-y-1">{incorrectSentences.map(s => <li key={s.id} className={`text-xs text-slate-400 line-through p-1 rounded transition-all ${glowingSentence?.text === s.text && glowingSentence?.type === 'incorrect' ? 'glow-red-temp' : ''}`}>{s.text}</li>)}</ul></div></div><div className="text-center"><h3 className="text-xl font-bold text-violet-400">Tutorial</h3><p className="text-slate-400">Make {correctAnswers.length} correct sentences. You still need {sentencesNeeded} more.</p>{correctAnswers.length > 1 && <p className="text-xs text-slate-500 mt-1 italic">Remember! Your sentences can TELL something or ASK something. You'll have to imagine punctuation like periods, commas, and question marks.</p>}</div><div className={`p-4 min-h-[6rem] border-2 border-dashed border-slate-700 rounded-lg flex flex-wrap items-center justify-center gap-2 transition-all duration-300 ${shake ? 'shake' : ''}`}>{sentence.length > 0 ? sentence.map((word, i) => <span key={i} className="px-3 py-2 bg-slate-700/50 text-slate-300 rounded-lg shadow-sm font-semibold">{word.text}</span>) : <span className="text-sm text-slate-400 italic">Click words below to build your sentence...</span>}</div><div className={`p-4 rounded-lg flex flex-wrap justify-center gap-2 bg-slate-800/60 transition-opacity ${dialogue.show ? 'opacity-50' : 'opacity-100'}`}>{words.filter(w => !w.inSentence).map(word => ( <button key={word.id} onClick={() => handleWordClick(word.id)} disabled={dialogue.show} className="p-2 rounded-md border border-slate-700 bg-slate-800/60 hover:bg-[#3e2e6b] text-slate-300 transition-all px-4 py-2 font-semibold disabled:opacity-50 disabled:cursor-not-allowed">{word.text}</button> ))}</div><div className={`flex items-center justify-center space-x-4 mt-8 transition-opacity ${dialogue.show ? 'opacity-50' : 'opacity-100'}`}><button onClick={handleCheck} disabled={dialogue.show} className="flex items-center justify-center gap-2 bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-8 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed"><IconCheck /><span>Check Sentence</span></button><button onClick={handleReset} disabled={dialogue.show} className="p-2 rounded-md border border-slate-700 bg-slate-800/60 hover:bg-[#3e2e6b] flex items-center justify-center gap-2 text-slate-300 font-bold py-3 px-8 transition-all disabled:opacity-50 disabled:cursor-not-allowed"><IconReset /><span>Reset Blocks</span></button></div><DialogueBox characterName={dialogue.name} characterImage={dialogue.image} text={dialogue.show ? dialogue.text : null} onClose={handleDialogueClose} /></div> );
        };
        
        // --- Assessment Setup Screen ---
        const AssessmentSetupScreen = ({ onStartAssessment, setError }) => {
            const [examinerName, setExaminerName] = useState('');
            const [studentName, setStudentName] = useState('');
            const [showPrivacyModal, setShowPrivacyModal] = useState(false);
            const [isMultiGrade, setIsMultiGrade] = useState(false);
            const [runTutorial, setRunTutorial] = useState(false);
            const [gradeSettings, setGradeSettings] = useState([{ grade: 'K', questions: 10 }]);

            const totalQuestions = useMemo(() => gradeSettings.reduce((sum, s) => sum + (s.questions || 0), 0), [gradeSettings]);
            const gradeOptions = useMemo(() => [ {value: 'K', label: 'Kindergarten'}, ...[...Array(12)].map((_, i) => ({ value: (i + 1).toString(), label: `Grade ${i + 1}`})) ], []);

            const handleGradeChange = (index, newGrade) => {
                const newSettings = [...gradeSettings];
                newSettings[index].grade = newGrade;
                setGradeSettings(newSettings);
            };

            const handleQuestionsChange = (index, newQuestions) => {
                const num = Math.max(0, parseInt(newQuestions, 10) || 0);
                const newSettings = [...gradeSettings];
                newSettings[index].questions = num;
                setGradeSettings(newSettings);
            };
            
            const addGrade = () => {
                if (gradeSettings.length < 3) {
                    const availableGrades = gradeOptions.filter(opt => !gradeSettings.some(s => s.grade === opt.value));
                    setGradeSettings([...gradeSettings, { grade: availableGrades[0]?.value || '1', questions: 0 }]);
                }
            };
            
            const removeGrade = (index) => {
                setGradeSettings(gradeSettings.filter((_, i) => i !== index));
            };

            const handleStart = () => {
                if (totalQuestions > 10 || totalQuestions < 1) {
                    setError("Total number of questions must be between 1 and 10.");
                    return;
                }
                const nonEmptyGrades = gradeSettings.filter(g => g.questions > 0);
                if (nonEmptyGrades.length === 0) {
                    setError("Please assign at least one question.");
                    return;
                }
                onStartAssessment({ examinerName, studentName, grades: nonEmptyGrades, numQuestions: totalQuestions, isMultiGrade, runTutorial });
            };

            return (
                <div className="space-y-8">
                    <h3 className="text-xl font-bold text-violet-400 text-center">Assessment Setup</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label htmlFor="examiner" className="text-slate-400">Examiner Name</label><input id="examiner" type="text" value={examinerName} onChange={(e) => setExaminerName(e.target.value)} className="w-full mt-2 p-3 rounded-md bg-slate-800/60 text-slate-300 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-violet-500" placeholder="Enter examiner's name" /></div>
                        <div><label htmlFor="student" className="text-slate-400 flex items-center gap-2">Student Name <button onClick={() => setShowPrivacyModal(true)} title="Privacy Information" className="text-slate-500 hover:text-violet-400 transition-colors"><IconInfo /></button></label><input id="student" type="text" value={studentName} onChange={(e) => setStudentName(e.target.value)} className="w-full mt-2 p-3 rounded-md bg-slate-800/60 text-slate-300 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-violet-500" placeholder="For printable report only" /></div>
                    </div>
                    
                    <div className="p-4 border border-slate-700 rounded-lg space-y-4">
                        <div className="flex items-center justify-between">
                            <h4 className="text-lg font-semibold text-violet-400">Question Selection</h4>
                            <label className="flex items-center gap-2 cursor-pointer text-slate-400"><input type="checkbox" checked={isMultiGrade} onChange={() => { setIsMultiGrade(!isMultiGrade); setGradeSettings([{ grade: 'K', questions: 10 }]); }} className="w-4 h-4 rounded text-violet-600 bg-slate-700 border-slate-600 focus:ring-violet-500"/> Enable Multi-Grade</label>
                        </div>
                        
                        {!isMultiGrade ? (
                            <div className="grid grid-cols-2 gap-4">
                                <div><label htmlFor="grade-level" className="text-slate-400 text-sm">Grade Level</label><select id="grade-level" value={gradeSettings[0].grade} onChange={(e) => handleGradeChange(0, e.target.value)} className="w-full mt-1 p-3 rounded-md bg-slate-800/60 text-slate-300 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-violet-500 appearance-none bg-no-repeat bg-right pr-8" style={{backgroundImage: `url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`, backgroundPosition: 'right 0.5rem center', backgroundSize: '1.5em 1.5em'}}>{gradeOptions.map(opt => <option key={opt.value} value={opt.value}>{opt.label}</option>)}</select></div>
                                <div><label htmlFor="num-questions" className="text-slate-400 text-sm">Number of Questions</label><input id="num-questions" type="number" value={gradeSettings[0].questions} onChange={(e) => handleQuestionsChange(0, e.target.value)} min="1" max="10" className="w-full mt-1 p-3 rounded-md bg-slate-800/60 text-slate-300 border border-slate-700"/></div>
                            </div>
                        ) : (
                            <div className="space-y-3">
                                {gradeSettings.map((setting, index) => (
                                    <div key={index} className="grid grid-cols-3 gap-3 items-center">
                                        <select value={setting.grade} onChange={(e) => handleGradeChange(index, e.target.value)} className="col-span-2 p-2 rounded-md bg-slate-700/80 text-slate-300 border border-slate-600 appearance-none bg-no-repeat bg-right pr-8" style={{backgroundImage: `url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`, backgroundPosition: 'right 0.5rem center', backgroundSize: '1.5em 1.5em'}}>{gradeOptions.map(opt => <option key={opt.value} value={opt.value} disabled={gradeSettings.some((s, i) => i !== index && s.grade === opt.value)}>{opt.label}</option>)}</select>
                                        <input type="number" value={setting.questions} onChange={(e) => handleQuestionsChange(index, e.target.value)} min="0" max="10" className="p-2 rounded-md bg-slate-700/80 text-slate-300 border border-slate-600"/>
                                        {gradeSettings.length > 1 && <button onClick={() => removeGrade(index)} className="text-red-500 hover:text-red-400">&times;</button>}
                                    </div>
                                ))}
                                <div className="flex justify-between items-center pt-2">
                                    <button onClick={addGrade} disabled={gradeSettings.length >= 3} className="text-sm text-violet-400 hover:text-violet-300 disabled:opacity-50 disabled:cursor-not-allowed">Add Grade</button>
                                    <p className={`text-sm font-semibold ${totalQuestions > 10 ? 'text-red-500' : 'text-slate-400'}`}>Total Questions: {totalQuestions} / 10</p>
                                </div>
                            </div>
                        )}
                    </div>
                     <div className="pt-2">
                        <label className="flex items-center gap-3 cursor-pointer text-slate-400">
                            <input type="checkbox" checked={runTutorial} onChange={(e) => setRunTutorial(e.target.checked)} className="w-5 h-5 rounded text-violet-600 bg-slate-700 border-slate-600 focus:ring-violet-500"/>
                             <span>Begin with tutorial?</span>
                        </label>
                        <p className="text-xs text-slate-500 mt-1 pl-8">This will provide the student with a trial question to get them used to the activity.</p>
                    </div>
                    <button onClick={handleStart} disabled={!examinerName || totalQuestions > 10 || totalQuestions < 1} className="w-full bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-8 rounded-lg transition disabled:bg-slate-600 disabled:cursor-not-allowed disabled:opacity-50">Start Assessment</button>
                    <PrivacyModal show={showPrivacyModal} onClose={() => setShowPrivacyModal(false)} />
                </div>
            );
        };

        // --- Main Assessment Screen ---
        const MainAppScreen = ({ onSubmit, settings }) => {
            const [questions, setQuestions] = useState([]);
            const [currentQIndex, setCurrentQIndex] = useState(0);
            const [currentSentence, setCurrentSentence] = useState([]);
            const [shuffledWords, setShuffledWords] = useState([]);
            const [completedSentences, setCompletedSentences] = useState([]);
            const [incorrectSentences, setIncorrectSentences] = useState([]);
            const [shake, setShake] = useState(false);
            const [isGlow, setIsGlow] = useState(false);
            const [glowingSentence, setGlowingSentence] = useState(null);
            const [score, setScore] = useState(0);
            const [totalPossibleScore, setTotalPossibleScore] = useState(0);
            const [assessmentLog, setAssessmentLog] = useState([]);
            
            const normalize = (str) => str.toLowerCase().replace(/[^\w\s]|_/g, "").replace(/\s+/g, " ").trim();
            const getShuffledWords = (words, correctAnswers) => {
                const correctOrders = correctAnswers.map(ans => normalize(ans));
                let shuffled;
                do { shuffled = shuffleArray([...words]); } while (correctOrders.some(ans => ans.startsWith(normalize(shuffled.join(' ')))));
                return shuffled;
            };

            useEffect(() => {
                let finalQuestions = [];
                settings.grades.forEach(gradeSetting => {
                    const gradeQuestions = allQuestions.filter(q => q.grade === gradeSetting.grade);
                    const selectedQuestions = shuffleArray(gradeQuestions).slice(0, gradeSetting.questions);
                    finalQuestions.push(...selectedQuestions);
                });
                const shuffledFinal = shuffleArray(finalQuestions);
                setQuestions(shuffledFinal);
                setTotalPossibleScore(shuffledFinal.reduce((acc, q) => acc + q.required, 0));
            }, [settings]);

            const currentQuestion = questions[currentQIndex];

            useEffect(() => {
                if (currentQuestion) {
                    setShuffledWords(getShuffledWords(currentQuestion.words, currentQuestion.correct));
                    setCurrentSentence([]);
                    setCompletedSentences([]);
                    setIncorrectSentences([]);
                }
            }, [currentQIndex, questions]);

            const logAndProceed = useCallback(() => {
                const logEntry = {
                    question: currentQuestion,
                    correctlyFormed: completedSentences,
                    incorrectAttempts: incorrectSentences.map(s => s.text),
                    score: completedSentences.length,
                };
                const newLog = [...assessmentLog, logEntry];
                setAssessmentLog(newLog);

                if (currentQIndex < questions.length - 1) {
                    setCurrentQIndex(prev => prev + 1);
                } else {
                    onSubmit({ settings, finalScore: score, totalPossible: totalPossibleScore, log: newLog });
                }
            }, [currentQIndex, questions, score, totalPossibleScore, settings, onSubmit, assessmentLog, currentQuestion, completedSentences, incorrectSentences]);

            useEffect(() => {
                if (currentQuestion && completedSentences.length > 0 && completedSentences.length === currentQuestion.required) {
                    setIsGlow(true);
                    const timer = setTimeout(() => { setIsGlow(false); logAndProceed(); }, 2000);
                    return () => clearTimeout(timer);
                }
            }, [completedSentences, currentQuestion, logAndProceed]);

            const handleWordClick = useCallback((word) => {
                setCurrentSentence(prev => [...prev, word]);
                setShuffledWords(prev => prev.filter(w => w !== word));
            }, []);
            
            const handleReset = useCallback(() => {
                setCurrentSentence([]);
                if (currentQuestion) setShuffledWords(getShuffledWords(currentQuestion.words, currentQuestion.correct));
            }, [currentQuestion]);

            const handlePass = useCallback(() => {
                logAndProceed();
            }, [logAndProceed]);

            const handleCheck = useCallback(() => {
                if (currentSentence.length === 0) return;
                const sentenceText = currentSentence.join(' ');
                const normalizedUserSentence = normalize(sentenceText);
                
                if (completedSentences.includes(sentenceText)) {
                    setGlowingSentence({ text: sentenceText, type: 'correct' });
                    setTimeout(() => setGlowingSentence(null), 1000);
                    handleReset();
                    return;
                }
                if (incorrectSentences.some(s => s.text === sentenceText)) {
                    incorrectSound.play();
                    setGlowingSentence({ text: sentenceText, type: 'incorrect' });
                    setTimeout(() => setGlowingSentence(null), 1000);
                    handleReset();
                    return;
                }

                const isCorrect = currentQuestion.correct.some(correctAnswer => normalize(correctAnswer) === normalizedUserSentence);
                
                if (isCorrect) {
                    correctSound.play();
                    setScore(s => s + 1);
                    setCompletedSentences(prev => [...prev, sentenceText]);
                } else {
                    incorrectSound.play();
                    setShake(true);
                    setIncorrectSentences(prev => [...prev, { text: sentenceText, id: Date.now() }]);
                    setTimeout(() => setShake(false), 500);
                }
                handleReset();
            }, [currentSentence, currentQuestion, completedSentences, incorrectSentences, handleReset]);
            
            if (!currentQuestion) return <div>Loading...</div>;
            const sentencesNeeded = currentQuestion.required - completedSentences.length;

            return ( <div className="space-y-6"><div className="text-center p-3 bg-slate-800/60 rounded-lg flex justify-between items-center text-slate-400"><p className="font-semibold">Question {currentQIndex + 1} of {questions.length}</p><p className="font-bold text-lg">Score: {score}</p></div><div className="grid grid-cols-2 gap-4 -mb-2"><div className="p-3 bg-slate-800/40 rounded-lg min-h-[6rem]"><h4 className="text-sm font-bold text-green-400 mb-2 text-center">Correct Sentences</h4><ul className="space-y-1">{completedSentences.map((s, i) => <li key={i} className={`text-xs text-slate-300 p-1 rounded transition-all ${glowingSentence?.text === s && glowingSentence?.type === 'correct' ? 'glow-green-temp' : ''}`}>{s}</li>)}</ul></div><div className="p-3 bg-slate-800/40 rounded-lg min-h-[6rem]"><h4 className="text-sm font-bold text-red-400 mb-2 text-center">Incorrect Attempts</h4><ul className="space-y-1">{incorrectSentences.map(s => <li key={s.id} className={`text-xs text-slate-400 line-through p-1 rounded transition-all ${glowingSentence?.text === s.text && glowingSentence?.type === 'incorrect' ? 'glow-red-temp' : ''}`}>{s.text}</li>)}</ul></div></div><div><h3 className="text-xl font-bold text-violet-400 text-center"> Make {currentQuestion.required} correct sentence{currentQuestion.required > 1 ? 's' : ''}. </h3>{sentencesNeeded > 0 ? <p className="text-center text-slate-400">You still need {sentencesNeeded} more.</p> : <p className="text-center text-green-400 font-bold">Great! All sentences formed!</p>}{currentQuestion.required > 1 && <p className="text-xs text-slate-500 mt-1 italic text-center">Remember! Your sentences can TELL something or ASK something. You'll have to imagine punctuation like periods, commas, and question marks.</p>}</div><div className={`p-4 min-h-[6rem] border-2 border-dashed border-slate-700 rounded-lg flex flex-wrap items-center justify-center gap-2 transition-all duration-300 ${shake ? 'shake' : ''} ${isGlow ? 'glow' : ''}`}>{currentSentence.map((word, i) => <span key={i} className="px-3 py-2 bg-slate-700/50 text-slate-300 rounded-lg font-semibold">{word}</span>)}</div><div className="p-4 rounded-lg flex flex-wrap justify-center gap-4 bg-slate-800/60 min-h-[6rem]">{shuffledWords.map((word, i) => ( <button key={i} onClick={() => handleWordClick(word)} className="p-2 rounded-md border border-slate-700 bg-slate-800/60 hover:bg-[#3e2e6b] text-slate-300 font-semibold transition-all px-4 py-2"> {word} </button> ))}</div><div className="flex items-start justify-center space-x-2 mt-6"><button onClick={handleCheck} className="flex items-center justify-center gap-2 bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-6 rounded-lg transition"> <IconCheck /> <span>Check</span> </button><button onClick={handleReset} className="p-2 rounded-md border border-slate-700 bg-slate-800/60 hover:bg-[#3e2e6b] flex items-center justify-center gap-2 text-slate-300 font-bold py-3 px-6 transition-all"> <IconReset /> <span>Reset</span> </button><button onClick={handlePass} className="p-2 rounded-md border border-slate-700 bg-slate-800/60 hover:bg-[#3e2e6b] flex items-center justify-center gap-2 text-slate-300 font-bold py-3 px-6 transition-all"> <IconPass /> <span>Pass</span> </button></div></div> );
        };
        
        // --- Results Screen ---
        const ResultsScreen = ({ onRestart, results }) => {
            if (!results) return <div>Loading results...</div>;

            const { settings, finalScore, totalPossible, log } = results;
            const scorePercentage = totalPossible > 0 ? ((finalScore / totalPossible) * 100).toFixed(0) : 0;
            
            const handleExport = () => {
                const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                const reportHTML = `
                    <!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Grammar Grid Report</title>
                    <style>
                        body { font-family: sans-serif; background-color: #0c0a18; color: #cbd5e1; line-height: 1.6; margin: 0; padding: 20px; }
                        .container { max-width: 800px; margin: auto; padding: 20px; background-color: #1e293b; border-radius: 12px; border: 1px solid #334155; }
                        header { text-align: center; border-bottom: 1px solid #334155; padding-bottom: 15px; margin-bottom: 25px; }
                        header img { max-width: 120px; margin-bottom: 10px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.3)); }
                        h1 { color: #a78bfa; margin: 0; font-size: 2.25rem; } h2 { color: #c4b5fd; border-bottom: 1px solid #334155; padding-bottom: 8px; margin-top: 25px; }
                        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; background-color: #0f172a; padding: 15px; border-radius: 8px; }
                        .info-grid p { margin: 0; } .info-grid strong { color: #a78bfa; }
                        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
                        th, td { text-align: left; padding: 10px; border-bottom: 1px solid #334155; }
                        th { background-color: #0f172a; }
                        .total-row { font-weight: bold; color: #a78bfa; font-size: 1.1rem; }
                        .question-block { margin-top: 15px; padding: 15px; background-color: #0f172a; border-radius: 8px; border-left: 4px solid #4f46e5; }
                        .word-bank { font-style: italic; color: #94a3b8; }
                        .user-answer { margin-left: 20px; }
                        .correct { color: #4ade80; } .incorrect { color: #f87171; text-decoration: line-through; }
                        ul { padding-left: 20px; margin-top: 5px; }
                    </style></head><body>
                    <div class="container">
                        <header>
                            <img src="https://raw.githubusercontent.com/navasdo/navacite/refs/heads/main/templates/static/navacite-images/navacite-gg-2.png" alt="Grammar Grid Navacite">
                            <h1>Assessment Report</h1>
                        </header>
                        <section>
                            <h2>Summary</h2>
                            <div class="info-grid">
                                <p><strong>Student Name:</strong> ${settings.studentName || '_______________________'}</p>
                                <p><strong>Examiner:</strong> ${settings.examinerName}</p>
                                <p><strong>Date:</strong> ${date}</p>
                                <p><strong>Total Score:</strong> <span class="total-row">${finalScore}/${totalPossible} (${scorePercentage}%)</span></p>
                            </div>
                        </section>
                        <section>
                            <h2>Details</h2>
                            ${log.map((entry, index) => `
                                <div class="question-block">
                                    <p><strong>Question ${index + 1}:</strong> Make ${entry.question.required} sentence(s).</p>
                                    <p class="word-bank">Word Bank: ${entry.question.words.join(', ')}</p>
                                    
                                    <p><strong>Student's Correct Sentences (${entry.score}/${entry.question.required}):</strong></p>
                                    ${entry.correctlyFormed.length > 0 ? `<ul>${entry.correctlyFormed.map(s => `<li class="correct">${s}</li>`).join('')}</ul>` : '<ul><li>None</li></ul>'}
                                    
                                    ${entry.incorrectAttempts.length > 0 ? `<p><strong>Incorrect Attempts:</strong></p><ul>${entry.incorrectAttempts.map(s => `<li class="incorrect">${s}</li>`).join('')}</ul>` : ''}
                                </div>
                            `).join('')}
                        </section>
                    </div></body></html>
                `;
                const blob = new Blob([reportHTML], { type: 'text/html' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `Grammar-Grid-Report_${settings.studentName || 'Student'}_${new Date().toISOString().split('T')[0]}.html`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            return (
                <div className="space-y-6 text-center">
                    <h3 className="text-xl font-bold text-violet-400">Assessment Complete</h3>
                    <div className="p-6 bg-slate-800/60 rounded-lg text-left max-w-md mx-auto space-y-2">
                        <p><strong className="text-slate-400">Examiner:</strong> {settings.examinerName}</p>
                        <p><strong className="text-slate-400">Student:</strong> {settings.studentName || 'N/A'}</p>
                        <p><strong className="text-slate-400">Final Score:</strong> <span className="font-bold text-2xl text-violet-400">{finalScore}/{totalPossible}</span> ({scorePercentage}%)</p>
                    </div>
                    <div className="flex justify-center items-center space-x-4">
                        <button onClick={handleExport} className="flex items-center space-x-2 bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-8 rounded-lg transition"> <IconExport /> <span>Export Report</span> </button>
                        <button onClick={onRestart} className="p-2 rounded-md border border-slate-700 bg-slate-800/60 hover:bg-[#3e2e6b] text-slate-300 font-bold py-3 px-8 transition-all"> New Assessment </button>
                    </div>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
{% endraw %}
</body>
</html>

